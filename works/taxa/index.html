<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="description" content="Dan Motzenbecker :: recent works"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimal-ui"><meta name="author" content="Dan Motzenbecker"><link href="/css/oxism.css" rel="stylesheet" type="text/css"><link href="/images/favicon.png" rel="icon" type="image/png"><link href="/images/favicon-152.png" rel="apple-touch-icon-precomposed"><link href="http://fonts.googleapis.com/css?family=Playfair+Display:700" rel="stylesheet" type="text/css"><title>Dan Motzenbecker</title></head><body class="perma"><section id="grid"><div id="info"><div><div class="cover"><h1>Dan<br>Motzenbecker</h1><br><h2>recent<br>works</h2></div><div class="image"></div></div></div><div id="meta"><div><div class="cover"><div><a id="email" class="button">email</a><a href="https://twitter.com/dcmotz" class="button">twitter</a><a href="https://github.com/dmotz" class="button">github</a></div></div></div></div><a id="oridomi-link" href="/works/oridomi" class="major"><div><div class="cover"><h2>OriDomi</h2></div><div class="image"></div></div></a><a id="pozaic-link" href="/works/pozaic" class="major"><div><div class="cover"><h2>Pozaic</h2></div><div class="image"></div></div></a><a id="exifexodus-link" href="/works/exifexodus" class="major"><div><div class="cover"><h2>Exif Exodus</h2></div><div class="image"></div></div></a><a id="chaincal-link" href="/works/chaincal" class="major"><div><div class="cover"><h2>ChainCal</h2></div><div class="image"></div></div></a><a id="hexaflip-link" href="/works/hexaflip" class="major"><div><div class="cover"><h2>HexaFlip</h2></div><div class="image"></div></div></a><a id="maskew-link" href="/works/maskew" class="major"><div><div class="cover"><h2>Maskew</h2></div><div class="image"></div></div></a><a id="turingtype-link" href="/works/turingtype" class="major"><div><div class="cover"><h2>TuringType</h2></div><div class="image"></div></div></a><a id="taxa-link" href="/works/taxa"><div><div class="cover"><h2>Taxa</h2></div></div></a><a id="stream-snitch-link" href="/works/stream-snitch"><div><div class="cover"><h2>stream-snitch</h2></div></div></a><a id="ear-pipe-link" href="/works/ear-pipe"><div><div class="cover"><h2>ear-pipe</h2></div></div></a><a id="statmap-link" href="/works/statmap"><div><div class="cover"><h2>statmap</h2></div></div></a><a id="commune-link" href="/works/commune"><div><div class="cover"><h2>Commune</h2></div></div></a><a id="express-spa-router-link" href="/works/express-spa-router"><div><div class="cover"><h2>Express Spa Router</h2></div></div></a><a id="monocat-link" href="/works/monocat"><div><div class="cover"><h2>Monocat</h2></div></div></a></section><section id="perma"><div id="perma-content"><a id="x" href="/">&times;</a><div id="content-oridomi"><h1>OriDomi</h1><h2>Fold the DOM up like paper.</h2><div class="images"><img src="/images/oridomi1.jpg"><img src="/images/oridomi2.jpg"></div><div class="buttons"><a href="http://oridomi.com" class="button">oridomi.com</a><a href="https://github.com/dmotz/oriDomi" class="button">github</a><a href="http://oridomi.com/docs/oridomi.html" class="button">annotated source</a></div><div class="content"><p>The web is flat, but with OriDomi you can fold it up. Open-source paper-folding library with animation queueing, touch support, and zero dependencies.</p></div><div class="tools">CoffeeScript / JavaScript, CSS3</div></div><div id="content-pozaic"><h1>Pozaic</h1><h2>Capture one second moments as animated gif mosaics.</h2><div class="images"><img src="/images/pozaic1.jpg"><img src="/images/pozaic2.gif"></div><div class="buttons"><a href="http://pozaic.com" class="button">pozaic.com</a></div><div class="content"><p>Pozaic uses WebRTC to connect friends (or strangers) in live video compositions you can turn into animated gifs. The medium captures a single second in time across geographic gaps.</p></div><div class="tools">Node.js, WebRTC, WebSockets, web workers</div></div><div id="content-exifexodus"><h1>Exif Exodus</h1><h2>Remove EXIF / GPS data from your photos before you upload them.</h2><div class="buttons"><a href="http://exifexodus.com" class="button">exifexodus.com</a><a href="https://github.com/dmotz/ExifExodus" class="button">github</a></div><div class="content"><h2 id="what-is-exif-">What is EXIF?</h2><p><a href="http://en.wikipedia.org/wiki/Exchangeable_image_file_format">EXIF</a> is a type of metadata that is embedded in photo files from most types of cameras and phones.</p><p>This metadata includes information about the device used to capture the photo, but also often includes the GPS coordinates of where the photo was taken.</p><p>Many users unknowingly share this information with the general public and site/app owners when uploading photos online.</p><p>This has been a common vector of privacy lapses, including cases where journalists have unintentionally published photos with geotagging data intact.</p><p>Recent press has also revealed the NSA&rsquo;s collection of EXIF data in its <a href="http://en.wikipedia.org/wiki/XKeyscore">XKeyscore</a> program.</p><h2 id="what-is-exifexodus-">What is ExifExodus?</h2><p>ExifExodus is a small piece of <a href="https://github.com/dmotz/ExifExodus">open-source code</a> that runs directly in your browser and strips EXIF data out of your photos before you upload them.</p><h2 id="how-does-it-work-">How does it work?</h2><p>You can run ExifExodus whenever you&rsquo;re uploading photos by using its bookmarklet (available on the <a href="http://exifexodus.com">site</a>)</p><p>When ExifExodus encounters a JPG file, it will remove the EXIF data by copying the pixels to a new image file, similar to taking a screenshot of something.</p><p>Alternatively, you can drop your files in the dropzone at the top of the <a href="http://exifexodus.com">site</a>) and receive versions free of EXIF data. You can then save these new files and upload them wherever you&rsquo;d like.</p><h2 id="is-exif-without-merit-">Is EXIF without merit?</h2><p>That&rsquo;s certainly not the implication of this project. Metadata adds another dimension to photos and is valuable for preserving context. This project aims to educate and give users a choice in the matter of sharing it with specific services (and the web at large).</p><h2 id="doesn-rsquo-t-facebook-etc-remove-exif-data-before-displaying-photos-">Doesn&rsquo;t Facebook (etc.) remove EXIF data before displaying photos?</h2><p>Yes. Although this prevents the general public from accessing your EXIF data, you should be aware that the end recipient is free to use or store the metadata before removing it.</p><h2 id="any-caveats-">Any caveats?</h2><p>The ExifExodus bookmarklet won&rsquo;t work with any site that uses Flash (or any other proprietary plugins like Silverlight) to upload files. For such sites, use the dropzone converter, save the output files, and upload those instead.</p><p>ExifExodus only works with JPG files (which is the most common image format to carry EXIF metadata).</p></div><div class="tools">CoffeeScript / JavaScript, web workers</div></div><div id="content-chaincal"><h1>ChainCal</h1><h2>The simple habit building app for iPhone.</h2><div class="images"><img src="/images/chaincal1.jpg"><img src="/images/chaincal2.jpg"></div><div class="buttons"><a href="http://chaincalapp.com" class="button">chaincalapp.com</a></div><div class="content"><p>Set daily goals and visualize your progress in an intuitive and visual way. Motivate yourself to adopt new positive habits one day at a time.</p></div><div class="tools">CoffeeScript / JavaScript, Apache Cordova, CSS3, Objective-C</div></div><div id="content-hexaflip"><h1>HexaFlip</h1><h2>Visualize arrays as cubes.</h2><div class="images"><img src="/images/hexaflip1.jpg"><img src="/images/hexaflip2.jpg"></div><div class="buttons"><a href="http://oxism.com/hexaflip" class="button">demo / docs</a><a href="https://github.com/dmotz/hexaflip" class="button">github</a><a href="http://tympanus.net/codrops/2013/03/07/hexaflip-a-flexible-3d-cube-plugin/" class="button">codrops article</a></div><div class="content"><p>Transform arrays of any length into cubes that can be rotated infinitely. Originally developed as the time picking interface for <a href="#chaincal">ChainCal</a>, I expanded it to visualize arbitrary arrays and wrote an article detailing the process on <a href="http://tympanus.net/codrops/2013/03/07/hexaflip-a-flexible-3d-cube-plugin/">Codrops</a>.</p></div><div class="tools">CoffeeScript / JavaScript, CSS3</div></div><div id="content-maskew"><h1>Maskew</h1><h2>Add some diagonal rhythm to your elements.</h2><div class="images"><img src="/images/maskew1.jpg"><img src="/images/maskew2.jpg"></div><div class="buttons"><a href="http://oxism.com/maskew" class="button">demo / docs</a><a href="https://github.com/dmotz/maskew" class="button">github</a></div><div class="content"><p>Skew the shapes of elements without distorting their contents. Maskew creates a parallelogram mask over the element and supports touch/mouse manipulation of the skew amount.</p></div><div class="tools">CoffeeScript / JavaScript, CSS3</div></div><div id="content-turingtype"><h1>TuringType</h1><h2>A na√Øve human typing simulation effect.</h2><div class="buttons"><a href="http://oxism.com/TuringType" class="button">demo / docs</a><a href="https://github.com/dmotz/TuringType" class="button">github</a></div><div class="content"><p>Written quickly to scratch an itch; not intended to be an accurate algorithm.</p><p>Watch the <a href="http://oxism.com/TuringType">demo</a> to see what it does.</p><p>Usage:</p><pre><code class="lang-javascript"><span class="hljs-keyword">new</span> TuringType(domElement, <span class="hljs-string">'Just some text.'</span>);
</code></pre><p>With some options:</p><pre><code class="lang-javascript"><span class="hljs-tag">new</span> <span class="hljs-tag">TuringType</span>(domElement, <span class="hljs-string">'Terrible but fast typist.'</span>, {
  <span class="hljs-attribute">accuracy</span>: <span class="hljs-number">0.3</span>,
  <span class="hljs-attribute">interval</span>: <span class="hljs-number">20</span>,
  <span class="hljs-attribute">callback</span>: allDone
});
</code></pre><p>Have fun.</p></div><div class="tools">CoffeeScript / JavaScript</div></div><div id="content-taxa" class="active"><h1>Taxa</h1><h2>A tiny language inside JavaScript to enforce type signatures.</h2><div class="buttons"><a href="https://github.com/dmotz/taxa" class="button">github</a></div><div class="content"><pre><code class="lang-javascript"><span class="hljs-comment">// denotes that add() accepts two numbers and returns a third:</span>
<span class="hljs-keyword">add</span> = t(<span class="hljs-string">'n,n n'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span> <span class="hljs-comment">{ return a + b }</span>);</span>
<span class="hljs-keyword">add</span>(<span class="hljs-number">3</span>, <span class="hljs-number">7</span>);
<span class="hljs-comment">// =&gt; 10</span>
<span class="hljs-keyword">add</span>(<span class="hljs-string">'3'</span>, <span class="hljs-string">'7'</span>);
<span class="hljs-comment">// =&gt; Taxa: Expected number as argument 0, given string (3) instead.</span>
</code></pre><h2 id="brief">Brief</h2><p>Taxa is a small metaprogramming experiment that introduces a minimal grammar for type annotations to JavaScript (and by extension, CoffeeScript).</p><p>Unlike other projects of this nature, Taxa is purely a runtime type checker rather than a static analyzer. When a Taxa-wrapped function receives or returns arguments of the wrong type, an exception is thrown.</p><p>Further unlike other type declaration projects for JavaScript, Taxa‚Äôs DSL lives purely within the syntax of the language. There is no intermediary layer and no preprocessing is required.</p><h2 id="grammar">Grammar</h2><p>Taxa type signatures are intended to be quick to type and to occupy few additional columns in your code.</p><p>Following this spirit of brevity, examples are also shown in CoffeeScript as it‚Äôs a natural fit to Taxa‚Äôs style.</p><p>In the following, Taxa is aliased as <code>t</code> (though <code>$</code> or <code>taxa</code> feel natural as well):</p><pre><code class="lang-coffeescript">t = <span class="hljs-built_in">require</span> <span class="hljs-string">'taxa'</span>
<span class="hljs-comment"># or in a browser without a module loader:</span>
t = <span class="hljs-built_in">window</span>.taxa
</code></pre><pre><code class="lang-javascript"><span class="hljs-reserved">var</span> t = <span class="hljs-built_in">require</span>(<span class="hljs-string">'taxa'</span>);
<span class="hljs-regexp">//</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">in</span> a browser without a <span class="hljs-built_in">module</span> <span class="hljs-attribute">loader</span>:
<span class="hljs-reserved">var</span> t = <span class="hljs-built_in">window</span>.taxa;
</code></pre><p>A type signature is composed of two halves: the argument types and the return type, separated by a space.</p><pre><code class="lang-coffeescript">pluralize = t <span class="hljs-string">'String String'</span>, <span class="hljs-function"><span class="hljs-params">(word)</span> -&gt;</span> word + <span class="hljs-string">'s'</span>
</code></pre><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> pluralize = t(<span class="hljs-string">'String String'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(word)</span> </span>{
  <span class="hljs-keyword">return</span> word + <span class="hljs-string">'s'</span>;
});
</code></pre><p>The above signature indicates a function that expects a single string argument and is expected to return a string as a result. If any other types are passed to it, an informative error will be thrown:</p><pre><code class="lang-coffeescript">pluralize <span class="hljs-number">7</span>
# =&gt; Tax<span class="hljs-variable">a:</span> Expected <span class="hljs-built_in">string</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">argument</span> <span class="hljs-number">0</span>, given <span class="hljs-keyword">number</span> (<span class="hljs-number">7</span>) instead.
</code></pre><pre><code class="lang-javascript">pluralize(<span class="hljs-number">7</span>);
// =&gt; Tax<span class="hljs-variable">a:</span> Expected <span class="hljs-built_in">string</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">argument</span> <span class="hljs-number">0</span>, given <span class="hljs-keyword">number</span> (<span class="hljs-number">7</span>) instead.
</code></pre><h3 id="shorthand">Shorthand</h3><p>Taxa provides a shorthand for built-in types, indicated by their first letter. The following is equivalent to the previous example:</p><pre><code class="lang-coffeescript">exclaim = t <span class="hljs-string">'s s'</span>, <span class="hljs-function"><span class="hljs-params">(word)</span> -&gt;</span> word + <span class="hljs-string">'!'</span>
</code></pre><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> exclaim = t(<span class="hljs-string">'s s'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(word)</span> </span>{
  <span class="hljs-keyword">return</span> word + <span class="hljs-string">'!'</span>;
});
</code></pre><p>Capital letter shorthand works as well:</p><pre><code class="lang-coffeescript">exclaim = t <span class="hljs-string">'S S'</span>, <span class="hljs-function"><span class="hljs-params">(word)</span> -&gt;</span> word + <span class="hljs-string">'!'</span>
</code></pre><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> exclaim = t(<span class="hljs-string">'S S'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(word)</span> </span>{
  <span class="hljs-keyword">return</span> word + <span class="hljs-string">'!'</span>;
});
</code></pre><p>The shorthand mapping is natural, with the exception of <code>null</code>:</p><ul><li><code>0 =&gt; null</code></li><li><code>a =&gt; array</code></li><li><code>b =&gt; boolean</code></li><li><code>f =&gt; function</code></li><li><code>n =&gt; number</code></li><li><code>o =&gt; object</code></li><li><code>s =&gt; string</code></li><li><code>u =&gt; undefined</code></li></ul><p>Multiple arguments are separated by commas:</p><pre><code class="lang-coffeescript">add = t <span class="hljs-string">'n,n n'</span>, (<span class="hljs-tag">a</span>, b) -&gt; <span class="hljs-tag">a</span> + b
</code></pre><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> add = t(<span class="hljs-string">'n,n n'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span> </span>{
  <span class="hljs-keyword">return</span> a + b;
});
</code></pre><p>The above function is expected to take two numbers as arguments and return a third.</p><h3 id="ignores">Ignores</h3><p>Occasionally you may want to ignore type checking on a particular argument. Use the <code>_</code> character to mark it as ignored in the signature. For example, you may have a method that produces effects without returning a value:</p><pre><code class="lang-coffeescript"><span class="hljs-attribute">Population</span>::setCount = t <span class="hljs-string">'n _'</span>, <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@count</span>)</span> -&gt;</span>
</code></pre><pre><code class="lang-javascript">Population.prototype.setCount = t(<span class="hljs-string">'n _'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(count)</span> </span>{
  <span class="hljs-keyword">this</span>.count = count;
});
</code></pre><p>Or a function that computes a result without input:</p><pre><code class="lang-coffeescript">t <span class="hljs-symbol">'_</span> n', -&gt; <span class="hljs-type">Math</span>.<span class="hljs-type">PI</span> / <span class="hljs-number">2</span>
</code></pre><pre><code class="lang-javascript">t(<span class="hljs-string">'_ n'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2</span>;
});
</code></pre><h3 id="optionals">Optionals</h3><p>Similarly you can specify arguments as optional and their type will only be checked if a value is present:</p><pre><code class="lang-coffeescript">t <span class="hljs-symbol">'s</span>,n? n', (<span class="hljs-built_in">string</span>, radix = <span class="hljs-number">10</span>) -&gt; parseInt <span class="hljs-built_in">string</span>, radix
</code></pre><pre><code class="lang-javascript"><span class="hljs-literal">t</span><span class="hljs-list">(<span class="hljs-quoted">'s</span>,n? n', function<span class="hljs-list">(<span class="hljs-keyword">string</span>, radix)</span> {
  if <span class="hljs-list">(<span class="hljs-keyword">radix</span> == null)</span> {
    radix = <span class="hljs-number">10</span><span class="hljs-comment">;</span>
  }
  return parseInt<span class="hljs-list">(<span class="hljs-keyword">string</span>, radix)</span><span class="hljs-comment">;</span>
})</span><span class="hljs-comment">;</span>
</code></pre><h3 id="ors">Ors</h3><p>For polymorphic functions that accept different types of arguments, you can use the <code>|</code> character to separate types.</p><pre><code class="lang-coffeescript">combine = t <span class="hljs-string">'n|s,n|s n|s'</span>, (<span class="hljs-tag">a</span>, b) -&gt; <span class="hljs-tag">a</span> + b
</code></pre><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> combine = t(<span class="hljs-string">'n|s,n|s n|s'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span> </span>{
  <span class="hljs-keyword">return</span> a + b;
});
</code></pre><p>For each argument and return type in the above function, either a number or a string is accepted.</p><h2 id="complex-types">Complex Types</h2><p>If you‚Äôd like to enforce types that are more specific than primitives, objects, and arrays, you‚Äôre free to do so:</p><pre><code class="lang-coffeescript">makeDiv = t <span class="hljs-string">'_ HTMLDivElement'</span>, <span class="hljs-function">-&gt;</span> <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
</code></pre><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> makeDiv = t(<span class="hljs-string">'_ HTMLDivElement'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
});
</code></pre><hr><pre><code class="lang-coffeescript">makeBuffer = t <span class="hljs-string">'n Buffer'</span>, <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span> <span class="hljs-keyword">new</span> Buffer n
</code></pre><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> makeBuffer = t(<span class="hljs-string">'n Buffer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Buffer(n);
});
</code></pre><p>Since all non-primitive types are objects, specifying <code>o</code> in your signatures will of course match complex types as well. However, passing a plain object or an object of another type to a function that expects a specific type (e.g. <code>WeakMap</code>) will correctly throw an error.</p><p>Keep in mind that Taxa is strict with these signatures and will not walk up an object‚Äôs inheritance chain to match ancestral types.</p><h2 id="partial-application">Partial Application</h2><p>Like any other function, those annotated with Taxa carry a <code>bind</code> method, which works as expected with the additional promise of modifying the output function‚Äôs Taxa signature.</p><p>For example:</p><pre><code class="lang-coffeescript"><span class="hljs-built_in">add</span>  = t <span class="hljs-string">'n,n n'</span>, (<span class="hljs-operator">a</span>, b) -&gt; <span class="hljs-operator">a</span> + b
add2 = <span class="hljs-built_in">add</span>.bind @, <span class="hljs-number">2</span>
add2 <span class="hljs-number">3</span>
<span class="hljs-comment"># =&gt; 5</span>
</code></pre><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> add = t(<span class="hljs-string">'n,n n'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span> </span>{
  <span class="hljs-keyword">return</span> a + b;
});
<span class="hljs-keyword">var</span> add2 = add.bind(<span class="hljs-keyword">this</span>, <span class="hljs-number">2</span>);
add2(<span class="hljs-number">3</span>);
<span class="hljs-comment">// =&gt; 5</span>
</code></pre><p>Under the covers, <code>add2</code>‚Äòs type signature was changed to <code>n n</code>.</p><h2 id="disabling">Disabling</h2><p>You can disable Taxa‚Äôs type enforcement behavior globally by calling <code>t.disable()</code> (where <code>t</code> is whatever you‚Äôve aliased Taxa as). This will cause calls to <code>t()</code> to perform a no-op wherein the original function is returned unmodified.</p><p>This is convenient for switching between environments without modifying code.</p><p>Its counterpart is naturally <code>t.enable()</code>.</p><h2 id="further-examples">Further Examples</h2><p>Take a look at the test cases in <code>./test/main.coffee</code> for more examples of Taxa signatures.</p><h2 id="caveats">Caveats</h2><p>When a function is modified by Taxa, its arity is not preserved as most JS environments don‚Äôt allow modifying a function‚Äôs length property. Workarounds to this problem would involve using the <code>Function</code> constructor which would introduce its own problems. This only has implications if you‚Äôre working with higher order functions that work by inspecting arity.</p><p>It should go without saying, but this library is experimental and has obvious performance implications.</p><p>Taxa is young and open to suggestions / contributors.</p><h2 id="name">Name</h2><p>From the Ancient Greek œÑŒ¨ŒæŒπœÇ (arrangement, order).</p></div><div class="tools">CoffeeScript / JavaScript</div></div><div id="content-stream-snitch"><h1>stream-snitch</h1><h2>Event emitter for watching text streams with regex patterns.</h2><div class="buttons"><a href="https://github.com/dmotz/stream-snitch" class="button">github</a></div><div class="content"><h3 id="intro">Intro</h3><p>stream-snitch is a tiny Node module that allows you to match streaming data patterns with regular expressions. It‚Äôs much like <code>... | grep</code>, but for Node streams using native events and regular expression objects. It‚Äôs also a good introduction to the benefits of streams if you‚Äôre unconvinced or unintroduced.</p><h3 id="use-cases">Use Cases</h3><p>The most obvious use case is scraping or crawling documents from an external source.</p><p>Typically you might buffer the incoming chunks from a response into a string buffer and then inspect the full response in the response‚Äôs <code>end</code> callback.</p><p>For instance, if you had a function intended to download all image URLs embedded in a document:</p><pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scrape</span><span class="hljs-params">(url, fn, cb)</span> </span>{
  http.<span class="hljs-keyword">get</span>(url, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> </span>{
    <span class="hljs-keyword">var</span> data = <span class="hljs-string">''</span>;
    res.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(chunk)</span> </span>{ data += chunk });
    res.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> rx = /&lt;img.+src=[<span class="hljs-string">"'](.+)['"</span>].?&gt;/gi, src;
      <span class="hljs-keyword">while</span> (src = rx.exec(data)) fn(src);
      cb();
    });
  });
}
</code></pre><p>Of course, the response could be enormous and bloat your <code>data</code> buffer. What‚Äôs worse is the response chunks could come slowly and you‚Äôd like to perform hundreds of these download tasks concurrently and get the job done as quickly as possible. Waiting for the entire response to finish negates part of the asynchronous benefits Node‚Äôs model offers and mainly ignores the fact that the response is a stream object that represents the data in steps as they occur.</p><p>Here‚Äôs the same task with stream-snitch:</p><pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scrape</span><span class="hljs-params">(url, fn, cb)</span> {</span>
  http.<span class="hljs-built_in">get</span>(url, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
    var snitch = <span class="hljs-keyword">new</span> StreamSnitch(/&lt;img.+src=[<span class="hljs-string">"'](.+)['"</span>].?&gt;/gi);
    snitch.<span class="hljs-keyword">on</span>(<span class="hljs-string">'match'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(match)</span> { <span class="hljs-title">fn</span><span class="hljs-params">(match[1])</span> });</span>
    <span class="hljs-keyword">res</span>.pipe(snitch);
    <span class="hljs-keyword">res</span>.<span class="hljs-keyword">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-keyword">cb</span>)
  });
}
</code></pre><p>The image download tasks (represented by <code>fn</code>) can occur as sources are found without having to wait for a potentially huge or slow request to finish first. Since you specify native regular expressions, the objects sent to <code>match</code> listeners will contain capture group matches as the above demonstrates (<code>match[1]</code>).</p><p>For crawling, you could match <code>href</code> properties and recursively pipe their responses through more stream-snitch instances.</p><p>Here‚Äôs another example (in CoffeeScript) from <a href="https://github.com/dmotz/soundscrape">soundscrape</a> that matches data from inline JSON:</p><pre><code class="lang-coffeescript"><span class="hljs-function"><span class="hljs-title">scrape</span> = <span class="hljs-params">(page, artist, title)</span> -&gt;</span>
  http.get <span class="hljs-string">"<span class="hljs-subst">#{ baseUrl }</span><span class="hljs-subst">#{ artist }</span>/<span class="hljs-subst">#{ title <span class="hljs-keyword">or</span> <span class="hljs-string">'tracks?page='</span> + page }</span>"</span>, <span class="hljs-function"><span class="hljs-params">(res)</span> -&gt;</span>
    snitch = <span class="hljs-keyword">new</span> StreamSnitch <span class="hljs-regexp">/bufferTracks\.push\((\{.+?\})\)/g</span>
    snitch[<span class="hljs-keyword">if</span> title <span class="hljs-keyword">then</span> <span class="hljs-string">'once'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'on'</span>] <span class="hljs-string">'match'</span>, <span class="hljs-function"><span class="hljs-params">(match)</span> -&gt;</span>
      download parse match[<span class="hljs-number">1</span>]
      scrape ++page, artist, title <span class="hljs-keyword">unless</span> ++trackCount % <span class="hljs-number">10</span>

    res.pipe snitch
</code></pre><h3 id="usage">Usage</h3><pre><code>$ npm <span class="hljs-keyword">install</span> stream-snitch
</code></pre><p>Create a stream-snitch instance with a search pattern, set a <code>match</code> callback, and pipe some data in:</p><pre><code class="lang-javascript"><span class="hljs-reserved">var</span> fs           = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>),
    StreamSnitch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'stream-snitch'</span>),
    albumList    = fs.createReadStream(<span class="hljs-string">'./recently_played_(HUGE).txt'</span>),
    cosmicSnitch = <span class="hljs-keyword">new</span> StreamSnitch(<span class="hljs-regexp">/^cosmic\sslop$/mgi</span>);

cosmicSnitch.<span class="hljs-literal">on</span>(<span class="hljs-string">'match'</span>, <span class="hljs-built_in">console</span>.log.bind(<span class="hljs-built_in">console</span>));
albumList.pipe(cosmicSnitch);
</code></pre><p>For the lazy, you can even specify the <code>match</code> event callback in the instantiation:</p><pre><code class="lang-javascript">var words = new StreamSnitch(/\s(\w+)\s/g, <span class="hljs-keyword">function</span>(m) { /* <span class="hljs-keyword">...</span> */ });
</code></pre><h3 id="caveats">Caveats</h3><p>stream-snitch is simple internally and uses regular expressions for flexibility, rather than more efficient procedural parsing. The first consequence of this is that it only supports streams of text and will decode binary buffers automatically.</p><p>Since it offers support for any arbitrary regular expressions including capture groups and start / end operators, chunks are internally buffered and examined and discarded only when matches are found. When given a regular expression in multiline mode (<code>/m</code>), the buffer is cleared at the start of every newline.</p><p>stream-snitch will periodically clear its internal buffer if it grows too large, which could occur if no matches are found over a large amount of data or you use an overly broad capture. There is the chance that legitimate match fragments could be discarded when the water mark is reached unless you specify a large enough buffer size for your needs.</p><p>The default buffer size is one megabyte, but you can pass a custom size like this if you anticipate a very large capture size:</p><pre><code class="lang-javascript">new StreamSnitch(/<span class="hljs-keyword">...</span>/g, { bufferCap: <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">20</span> });
</code></pre><p>If you want to reuse a stream-snitch instance after one stream ends, you can manually call the <code>clearBuffer()</code> method.</p><p>It should be obvious, but remember to use the <code>m</code> (multiline) flag in your patterns if you‚Äôre using the <code>$</code> operator for looking at endings on a line by line basis. If you‚Äôre legitimately looking for a pattern at the end of a document, stream-snitch only offers some advantage over buffering the entire response, in that it periodically discards chunks from memory.</p></div><div class="tools">Node.js</div></div><div id="content-ear-pipe"><h1>ear-pipe</h1><h2>Pipe audio streams to your ears.</h2><div class="buttons"><a href="https://github.com/dmotz/ear-pipe" class="button">github</a></div><div class="content"><h3 id="concept">Concept</h3><p>ear-pipe is a duplex stream that allows you to pipe any streaming audio data to your ears (by default), handling any decoding automatically for most formats. You can also leverage this built-in decoding by specifying an output encoding and pipe the output stream somewhere else.</p><h3 id="installation">Installation</h3><p>ear-pipe relies on the cross-platform audio utility <a href="http://sox.sourceforge.net">SoX</a>, so make sure that‚Äôs installed first.</p><pre><code>$ npm <span class="hljs-operator"><span class="hljs-keyword">install</span> <span class="hljs-comment">--save ear-pipe</span></span>
</code></pre><h3 id="usage">Usage</h3><pre><code class="lang-javascript">var EarPipe = require('ear-pipe'),
    ep      = <span class="hljs-keyword">new</span> EarPipe(/* &lt;<span class="hljs-class"><span class="hljs-keyword">type</span>&gt;, &lt;bitrate&gt;, &lt;transcode-type&gt; */);</span>
</code></pre><p>When arguments are omitted (e.g. <code>ep = new EarPipe;</code>), the type defaults to <code>&#39;mp3&#39;</code>, the bitrate defaults to <code>16</code>, and the third argument is <code>null</code> indicating that the pipe destination is your ears rather than a transcoded stream.</p><p>If your input encoding isn‚Äôt mp3, make sure you set it to one of the formats supported by SoX:</p><pre><code><span class="hljs-number">8</span>svx aif aifc aiff aiffc <span class="hljs-keyword">al</span> amb <span class="hljs-keyword">au</span> avr cdda cdr cvs cvsd cvu dat dvms f32 f4 f64
f8 fssd gsm gsrt hcom htk ima ircam <span class="hljs-keyword">la</span> lpc lpc10 <span class="hljs-keyword">lu</span> maud mp2 mp3 nist prc raw s1
s16 s2 s24 s3 s32 s4 s8 <span class="hljs-keyword">sb</span> <span class="hljs-keyword">sf</span> <span class="hljs-keyword">sl</span> sln smp snd sndr sndt sou sox sph <span class="hljs-keyword">sw</span> txw u1 u16
u2 u24 u3 u32 u4 u8 ub ul uw vms voc vox wav wavpcm wve <span class="hljs-keyword">xa</span>
</code></pre><h3 id="examples">Examples</h3><h4 id="http-stream">HTTP Stream</h4><p>Let‚Äôs pipe some <a href="http://en.wikipedia.org/wiki/Number_stations">number station</a> audio to our ears right as it comes off the wire:</p><pre><code class="lang-javascript">http.<span class="hljs-keyword">get</span>(
  <span class="hljs-string">'http://ia700500.us.archive.org/12/items/ird059/tcp_d1_06_the_lincolnshire_poacher_mi5_irdial.mp3'</span>,
  <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> </span>{ res.pipe(<span class="hljs-keyword">new</span> EarPipe) });
</code></pre><p>If your connection and speakers work, you should hear it as it downloads.</p><h4 id="nondeterministic-dj-set">Nondeterministic DJ Set</h4><p>Let‚Äôs send multiple audio streams to the same ear-pipe:</p><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> ep      = <span class="hljs-keyword">new</span> EarPipe,
    telstar = fs.createReadStream(<span class="hljs-string">'./telstar.mp3'</span>),
    cream   = fs.createReadStream(<span class="hljs-string">'./cream.mp3'</span>);

http.<span class="hljs-keyword">get</span>(<span class="hljs-string">'http://127.0.0.1/sirens.mp3'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> </span>{ res.pipe(ep) });
telstar.pipe(ep);
cream.pipe(ep);
</code></pre><p>Since only one chunk passes through at a time, this DJ set should have plenty of cuts.</p><h4 id="transcode">Transcode</h4><p>Since we‚Äôre decoding the audio on the fly, we can specify that we‚Äôd like to use that output for another destination besides our ears:</p><pre><code class="lang-javascript"><span class="hljs-regexp">//</span> <span class="hljs-literal">null</span> arguments mean defaults, <span class="hljs-literal">true</span> implies <span class="hljs-reserved">default</span> output encoding (wav)
<span class="hljs-reserved">var</span> ep    = <span class="hljs-keyword">new</span> EarPipe(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>),
    hotel = fs.createReadStream(<span class="hljs-string">'./hotel.mp3'</span>);

hotel.pipe(ep).pipe(fs.createWriteStream(<span class="hljs-string">'./hotel.wav'</span>));
</code></pre><p>Or pipe to another process:</p><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> ep      = <span class="hljs-keyword">new</span> EarPipe(<span class="hljs-string">'wav'</span>),
    epTrans = <span class="hljs-keyword">new</span> EarPipe(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>),
    audio   = someStreamingNetworkData();

audio.pipe(epTrans).pipe(ep);
epTrans.pipe(anotherStreamingAudioConsumer);
</code></pre><h3 id="killing">Killing</h3><p>Kill an ear-pipe instance by calling its <code>kill()</code> method. If you‚Äôre interested in the underlying SoX process, access an instance‚Äôs <code>.process</code> property.</p></div><div class="tools">Node.js</div></div><div id="content-statmap"><h1>statmap</h1><h2>Output recursive directory stats as JSON for visualization and analysis.</h2><div class="buttons"><a href="https://github.com/dmotz/statmap" class="button">github</a></div><div class="content"><h3 id="installation-and-usage">Installation and Usage</h3><p><strong>As a system executable:</strong></p><pre><code>$ npm <span class="hljs-keyword">install</span> -g statmap
</code></pre><p>When used as an executable, statmap returns JSON over stdout.</p><p>To map the current directory:</p><pre><code><span class="hljs-variable">$ </span>statmap &gt; stats.json
</code></pre><p>Pass an optional argument for a different directory:</p><pre><code><span class="hljs-variable">$ </span>statmap .. &gt; parent.json
</code></pre><p>The JSON will contain a recursive representation of the directory and all children. Each key is a file or directory name with a corresponding value containing a <code>stats</code> object and a <code>children</code> object if it is a directory. Directories also are also given a <code>sum</code> property which reflects the size of all children recursively, unlike the typical <code>size</code> property of directory‚Äôs <code>stats</code> object.</p><p>Here‚Äôs an excerpt of the output for the package itself:</p><pre><code class="lang-javascript">{
  <span class="hljs-string">"statmap"</span>: {
    <span class="hljs-string">"stats"</span>: {
      <span class="hljs-string">"dev"</span>: <span class="hljs-number">16777220</span>,
      <span class="hljs-string">"mode"</span>: <span class="hljs-number">16877</span>,
      <span class="hljs-string">"nlink"</span>: <span class="hljs-number">9</span>,
      <span class="hljs-string">"uid"</span>: <span class="hljs-number">501</span>,
      <span class="hljs-string">"gid"</span>: <span class="hljs-number">80</span>,
      <span class="hljs-string">"rdev"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">"blksize"</span>: <span class="hljs-number">4096</span>,
      <span class="hljs-string">"ino"</span>: <span class="hljs-number">141035615</span>,
      <span class="hljs-string">"size"</span>: <span class="hljs-number">306</span>,
      <span class="hljs-string">"blocks"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">"atime"</span>: <span class="hljs-string">"2013-11-25T01:02:05.000Z"</span>,
      <span class="hljs-string">"mtime"</span>: <span class="hljs-string">"2013-11-25T01:02:05.000Z"</span>,
      <span class="hljs-string">"ctime"</span>: <span class="hljs-string">"2013-11-25T01:02:05.000Z"</span>
    },
    <span class="hljs-string">"sum"</span>: <span class="hljs-number">165329</span>,
    <span class="hljs-string">"children"</span>: {
      <span class="hljs-string">"README.md"</span>: {
        <span class="hljs-string">"stats"</span>: {
          <span class="hljs-string">"dev"</span>: <span class="hljs-number">16777220</span>,
          <span class="hljs-string">"mode"</span>: <span class="hljs-number">33188</span>,
          <span class="hljs-string">"nlink"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-string">"uid"</span>: <span class="hljs-number">501</span>,
          <span class="hljs-string">"gid"</span>: <span class="hljs-number">80</span>,
          <span class="hljs-string">"rdev"</span>: <span class="hljs-number">0</span>,
          <span class="hljs-string">"blksize"</span>: <span class="hljs-number">4096</span>,
          <span class="hljs-string">"ino"</span>: <span class="hljs-number">141057002</span>,
          <span class="hljs-string">"size"</span>: <span class="hljs-number">550</span>,
          <span class="hljs-string">"blocks"</span>: <span class="hljs-number">8</span>,
          <span class="hljs-string">"atime"</span>: <span class="hljs-string">"2013-11-25T01:02:05.000Z"</span>,
          <span class="hljs-string">"mtime"</span>: <span class="hljs-string">"2013-11-25T01:01:52.000Z"</span>,
          <span class="hljs-string">"ctime"</span>: <span class="hljs-string">"2013-11-25T01:01:54.000Z"</span>
        }
      },
      <span class="hljs-string">"index.js"</span>: {
        <span class="hljs-string">"stats"</span>: {
          <span class="hljs-string">"dev"</span>: <span class="hljs-number">16777220</span>,
          <span class="hljs-string">"mode"</span>: <span class="hljs-number">33188</span>,
          <span class="hljs-string">"nlink"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-string">"uid"</span>: <span class="hljs-number">501</span>,
          <span class="hljs-string">"gid"</span>: <span class="hljs-number">80</span>,
          <span class="hljs-string">"rdev"</span>: <span class="hljs-number">0</span>,
          <span class="hljs-string">"blksize"</span>: <span class="hljs-number">4096</span>,
          <span class="hljs-string">"ino"</span>: <span class="hljs-number">141035626</span>,
          <span class="hljs-string">"size"</span>: <span class="hljs-number">1180</span>,
          <span class="hljs-string">"blocks"</span>: <span class="hljs-number">8</span>,
          <span class="hljs-string">"atime"</span>: <span class="hljs-string">"2013-11-25T01:02:06.000Z"</span>,
          <span class="hljs-string">"mtime"</span>: <span class="hljs-string">"2013-11-25T00:51:31.000Z"</span>,
          <span class="hljs-string">"ctime"</span>: <span class="hljs-string">"2013-11-25T00:51:31.000Z"</span>
        }
      },
      <span class="hljs-string">"node_modules"</span>: {
        <span class="hljs-string">"stats"</span>: {
          <span class="hljs-string">"dev"</span>: <span class="hljs-number">16777220</span>,
          <span class="hljs-string">"mode"</span>: <span class="hljs-number">16877</span>,
          <span class="hljs-string">"nlink"</span>: <span class="hljs-number">3</span>,
          <span class="hljs-string">"uid"</span>: <span class="hljs-number">501</span>,
          <span class="hljs-string">"gid"</span>: <span class="hljs-number">20</span>,
          <span class="hljs-string">"rdev"</span>: <span class="hljs-number">0</span>,
          <span class="hljs-string">"blksize"</span>: <span class="hljs-number">4096</span>,
          <span class="hljs-string">"ino"</span>: <span class="hljs-number">141036545</span>,
          <span class="hljs-string">"size"</span>: <span class="hljs-number">102</span>,
          <span class="hljs-string">"blocks"</span>: <span class="hljs-number">0</span>,
          <span class="hljs-string">"atime"</span>: <span class="hljs-string">"2013-11-25T00:53:55.000Z"</span>,
          <span class="hljs-string">"mtime"</span>: <span class="hljs-string">"2013-11-24T23:00:54.000Z"</span>,
          <span class="hljs-string">"ctime"</span>: <span class="hljs-string">"2013-11-24T23:00:54.000Z"</span>
        },
        <span class="hljs-string">"sum"</span>: <span class="hljs-number">124651</span>,
        <span class="hljs-string">"children"</span>: {
          <span class="hljs-string">"async"</span>: {
            <span class="hljs-string">"stats"</span>: {
        //<span class="hljs-keyword">...</span>
</code></pre><p>Using this data, you could create something like a <a href="http://mbostock.github.io/d3/talk/20111018/treemap.html">D3 zoomable treemap</a> of your hard drive.</p><p><strong>As a library:</strong></p><pre><code>$ npm <span class="hljs-operator"><span class="hljs-keyword">install</span> <span class="hljs-comment">--save statmap</span></span>
</code></pre><p>Pass a path and a callback:</p><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> statmap = <span class="hljs-built_in">require</span>(<span class="hljs-string">'statmap'</span>);

statmap(<span class="hljs-string">'./spells'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, stats)</span> </span>{
  <span class="hljs-built_in">console</span>.log(utils.inspect(stats, { color: <span class="hljs-literal">true</span>, depth: <span class="hljs-literal">null</span> }));
});
</code></pre><p>When used as a library, a live object is returned rather than a JSON string.</p></div><div class="tools">Node.js</div></div><div id="content-commune"><h1>Commune</h1><h2>Web workers lose their chains: Easy threads without separate function files.</h2><div class="buttons"><a href="https://github.com/dmotz/commune.js" class="button">github</a></div><div class="content"><h3 id="intro">Intro</h3><p>Commune.js makes it easy to run computationally heavy functions in a separate thread and retrieve the results asynchronously. By delegating these functions to a separate thread, you can avoid slowing down the main thread that affects the UI. Think of it as a way to leverage the web workers API without ever having to think about the web workers API.</p><p>Using straightforward syntax, you can add web worker support to your app‚Äôs functions without the need to create separate files (as web workers typically require) and without the need to change the syntax of your functions. Best of all, everything will work without problems on browsers that do not support web workers.</p><h3 id="usage">Usage</h3><p>Here‚Äôs an example where the first argument is the function to thread, the second argument is an array of arguments to pass to it, and the third is a callback to handle the result once it comes through:</p><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> heavyFunction = function(a, b, c){
    // <span class="hljs-keyword">do</span> some work <span class="hljs-number">100</span> million times
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1</span>e9; i++){
        a++;
        b++;
        c++;
    }
    // <span class="hljs-keyword">return</span> arguments modified
    <span class="hljs-keyword">return</span> [a, b, c];
}

commune(heavyFunction, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], function(<span class="hljs-literal">result</span>){
    console.log(<span class="hljs-literal">result</span>); // [<span class="hljs-number">100000001</span>, <span class="hljs-number">100000002</span>, <span class="hljs-number">100000003</span>]
});

//go ahead <span class="hljs-keyword">and</span> <span class="hljs-keyword">continue</span> <span class="hljs-keyword">with</span> more work <span class="hljs-keyword">in</span> the main thread <span class="hljs-keyword">without</span> being held up:
console.log('I will appear before the loop finishes.');

setTimeout(function(){
    console.log('I probably will too, depending on how fast your <span class="hljs-type">CPU</span> <span class="hljs-keyword">is</span>.');
}, <span class="hljs-number">500</span>);
</code></pre><p>In a browser that supports worker threads, the above will output:</p><pre><code>I will appear <span class="hljs-keyword">before</span> <span class="hljs-keyword">the</span> loop finishes.
I probably will too, depending <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> how fast your CPU <span class="hljs-keyword">is</span>.
[<span class="hljs-number">100000001</span>, <span class="hljs-number">100000002</span>, <span class="hljs-number">100000003</span>]
</code></pre><p>In a browser without web worker support, everything still works, just in a different order:</p><pre><code>[<span class="hljs-number">100000001</span>, <span class="hljs-number">100000002</span>, <span class="hljs-number">100000003</span>]
I will appear <span class="hljs-keyword">before</span> <span class="hljs-keyword">the</span> loop finishes.
I probably will too, depending <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> how fast your CPU <span class="hljs-keyword">is</span>.
</code></pre><p>With Commune.js, we could proceed with our work in the main thread without waiting to loop 100 million times.</p><p>Further proof:</p><pre><code class="lang-javascript">commune(heavyFunction, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], function(<span class="hljs-literal">result</span>){
    console.log(<span class="hljs-literal">result</span>); // [<span class="hljs-number">100000001</span>, <span class="hljs-number">100000002</span>, <span class="hljs-number">100000003</span>]
});

commune(heavyFunction, [<span class="hljs-number">50</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>], function(<span class="hljs-literal">result</span>){
    console.log(<span class="hljs-literal">result</span>); // [<span class="hljs-number">100000050</span>, <span class="hljs-number">100000060</span>, <span class="hljs-number">100000070</span>]
});

commune(heavyFunction, [<span class="hljs-number">170</span>, <span class="hljs-number">180</span>, <span class="hljs-number">190</span>], function(<span class="hljs-literal">result</span>){
    console.log(<span class="hljs-literal">result</span>); // [<span class="hljs-number">100000170</span>, <span class="hljs-number">100000180</span>, <span class="hljs-number">100000190</span>]
});
</code></pre><p>Running the above in a browser with worker support, you‚Äôll see the results of each function call appear simultaneously, meaning that none of these large loops had to wait for the others to finish before starting. Using Commune.js with care, you can bring asynchronicity and parallelism to previously inapplicable areas.</p><p>To simplify things more, you can DRY up your syntax with the help of <code>communify()</code> which transforms your vanilla function into a Commune-wrapped version:</p><pre><code class="lang-javascript"><span class="hljs-keyword">var</span> abcs = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span></span>{
    <span class="hljs-keyword">var</span> s = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; n; i++){
        s += <span class="hljs-string">'abc'</span>;
    }
    <span class="hljs-keyword">return</span> s;
}

<span class="hljs-comment">// Communify the function for future calls:</span>
abcs = communify(abcs);

<span class="hljs-comment">// Or designate some partial application:</span>
abcs = communify(abcs, [<span class="hljs-number">5</span>]);

<span class="hljs-comment">// Then call it later in a simplified manner:</span>
abcs(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(s)</span></span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'my opus:'</span>, s);
});

<span class="hljs-comment">// Even cleaner with named functions:</span>
abcs(alert);

<span class="hljs-comment">// If you didn't use partial application with the original communify call:</span>
abcs([<span class="hljs-number">10</span>], alert);
</code></pre><h3 id="how-it-works">How It Works</h3><p>When you pass a new function to Commune.js, it creates a modified version of the function using web worker syntax. Commune.js memoizes the result so additional calls using the same function don‚Äôt have to be rewritten.</p><p>Just write your functions as you normally would using return statements.</p><p>Commune.js automatically creates binary blobs from your functions that can be used as worker scripts.</p><h3 id="caveats">Caveats</h3><p>Since web workers operate in a different context, you can‚Äôt reference any variables outside of the function‚Äôs scope (including the DOM) and you can‚Äôt use references to <code>this</code> since it will refer to the worker itself. For functions you want to use Commune.js with, use a functional style where they return a modified version of their input.</p><p>Also, since this is an abstraction designed for ease-of-use and flexibility, it does not work exactly as web workers do ‚Äî namely you can‚Äôt have multiple return events from a single worker.</p></div><div class="tools">CoffeeScript / JavaScript, web workers</div></div><div id="content-express-spa-router"><h1>Express Spa Router</h1><h2>Internally reroute non-AJAX requests to your client-side single page app router.</h2><div class="buttons"><a href="https://github.com/dmotz/express-spa-router" class="button">github</a></div><div class="content"><h3 id="concept">Concept</h3><p>Let‚Äôs say you have a modern single page web application with client-side URL routing (e.g. Backbone).</p><p>Since views are rendered on the client, you‚Äôll likely use RESTful Express routes that handle a single concern and return only JSON back to the client. The app‚Äôs only non-JSON endpoint is likely the index route (<code>/</code>).</p><p>So while <code>/users</code> might return a JSON array when hit via the client app‚Äôs AJAX call, you‚Äôll want to handle that request differently if the user clicks a link from an external site or manually types it in the address bar. When hit in this context, this middleware internally redirects the request to the index route handler, so the same client-side app is loaded for every valid route. The URL for the end user remains the same and the client-side app uses its own router to show the user what‚Äôs been requested based on the route. This eliminates the tedium of performing this kind of conditional logic within individual route callbacks.</p><h3 id="installation">Installation</h3><pre><code>$ npm <span class="hljs-operator"><span class="hljs-keyword">install</span> <span class="hljs-comment">--save express-spa-router</span></span>
</code></pre><h3 id="usage">Usage</h3><p>In your Express app‚Äôs configuration, place this middleware high up the stack (before <code>router</code> and <code>static</code>) and pass it your app instance:</p><pre><code class="lang-javascript">app.<span class="hljs-keyword">use</span>(<span class="hljs-keyword">require</span>(<span class="hljs-string">'express-spa-router'</span>)(app));
</code></pre><p>AJAX requests will be untouched, but valid routes called without AJAX will result in the the index route‚Äôs result being returned. Non-matching routes will be passed down the stack by default and will be end up being handled by whatever your app does with 404s. This can be overridden by passing a <code>noRoute</code> function in the options object:</p><pre><code class="lang-javascript"><span class="hljs-tag">app</span><span class="hljs-class">.use</span>(<span class="hljs-function">require</span>(<span class="hljs-string">'express-spa-router'</span>)(app,
  {
    <span class="hljs-tag">noRoute</span>: <span class="hljs-tag">function</span>(req, res, next) {
      <span class="hljs-comment">//handle unmatched route</span>
    }
  }
));
</code></pre><p>Express‚Äôs default static paths are passed along correctly by default (as are <code>/js</code> and <code>/css</code>), but if you use different paths or have additional static files in your <code>public</code> directory, make sure to specify them in the options either via a regular expression or an array of directory names:</p><pre><code class="lang-javascript"><span class="hljs-tag">app</span><span class="hljs-class">.use</span>(<span class="hljs-function">require</span>(<span class="hljs-string">'express-spa-router'</span>)(app, {<span class="hljs-attribute">staticPaths</span>: [<span class="hljs-string">'js'</span>, <span class="hljs-string">'css'</span>, <span class="hljs-string">'uploads'</span>]}));
</code></pre><p>You may also have valid client-side routes that don‚Äôt exist on the server-side. Rather than having them reach the 404 handler, you can specify them in the configuration options using <code>extraRoutes</code> and passing either a regular expression or an array:</p><pre><code class="lang-javascript"><span class="hljs-tag">app</span><span class="hljs-class">.use</span>(<span class="hljs-function">require</span>(<span class="hljs-string">'express-spa-router'</span>)(app, {<span class="hljs-attribute">extraRoutes</span>: [<span class="hljs-string">'about'</span>, <span class="hljs-string">'themes'</span>]}));
</code></pre><p>Finally, if you want to route non-AJAX <code>GET</code> requests to certain routes normally, pass paths in the <code>ignore</code> option:</p><pre><code class="lang-javascript"><span class="hljs-tag">app</span><span class="hljs-class">.use</span>(<span class="hljs-function">require</span>(<span class="hljs-string">'express-spa-router'</span>)(app, {<span class="hljs-attribute">ignore</span>: [<span class="hljs-string">'api'</span>]}));
</code></pre></div><div class="tools">Node.js</div></div><div id="content-monocat"><h1>Monocat</h1><h2>Automated asset inlining.</h2><div class="buttons"><a href="https://github.com/dmotz/monocat" class="button">github</a></div><div class="content"><p>Monocat is ideal for deploying small, static, single-page sites where you want to minimize the number of http requests. Monocat compresses and writes the contents of external assets into the html source for an easy speed optimization.</p><h3 id="installation-">Installation:</h3><p>You‚Äôll need <a href="http://nodejs.org">Node.js</a> installed. Then:</p><pre><code>$ npm <span class="hljs-keyword">install</span> -g monocat
</code></pre><h3 id="usage-">Usage:</h3><p>Monocat works sort of like a jQuery plugin, but from the commandline.</p><p>Just add the class <code>monocat</code> to any <code>&lt;script&gt;</code> or <code>&lt;link&gt;</code> (stylesheets only) tag you want to inline:</p><pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"css/main.css"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"monocat"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"js/huge-lib.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"js/main.js"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"monocat"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre><p>Notice that the second tag will be ignored since it lacks the <code>monocat</code> class.</p><p>To create an optimized version of your html file, run this:</p><pre><code>$ monocat <span class="hljs-keyword">index</span>.html
</code></pre><p>By default, this will create a ready-to-deploy file called <code>index_monocat.html</code> in the same directory.</p><p>Pass an optional output filename as the second argument:</p><pre><code>$ monocat src/<span class="hljs-keyword">index</span>.html build/<span class="hljs-keyword">index</span>.html
</code></pre></div><div class="tools">Node.js</div></div></div></section><script src="/js/oxism.js"></script><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-30392798-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>